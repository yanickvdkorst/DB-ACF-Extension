
image: atlassian/default-image:3

pipelines:
  tags:
    "v*":                       # draait voor bv. v1.2.8
      - step:
          name: "Build WP-ready ZIP"
          script:
            - git fetch --tags
            - echo "BITBUCKET_TAG=${BITBUCKET_TAG}"
            # Bouw ZIP met vaste topmap 'db-acf-extension/'
            - git archive --format=zip --output "db-acf-extension-${BITBUCKET_TAG}.zip" --prefix=db-acf-extension/ "${BITBUCKET_TAG}"
            - ls -lh "db-acf-extension-${BITBUCKET_TAG}.zip"
          artifacts:
            - "db-acf-extension-${BITBUCKET_TAG}.zip"

      - step:
          name: "Upload ZIP naar Bitbucket Downloads"
          script:
            - pipe: atlassian/bitbucket-upload-file:0.7.5
              variables:
                ATLASSIAN_ACCOUNT_EMAIL: $ATLASSIAN_ACCOUNT_EMAIL
                ATLASSIAN_API_TOKEN: $ATLASSIAN_API_TOKEN
                FILENAME: "db-acf-extension-${BITBUCKET_TAG}.zip"
